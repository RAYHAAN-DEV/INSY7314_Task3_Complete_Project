version: 2.1

jobs:
  build:
    docker:
      - image: cimg/node:20.10
    steps:
      - checkout
      - run: npm install --no-optional
      - run: echo "✅ Build complete"

  sonar_scan:
    docker:
      - image: cimg/openjdk:17.0
    steps:
      - checkout
      - run: |
          echo "🔍 Running SonarCloud analysis..."
          curl -sSLo sonar-scanner.zip https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-5.0.1.3006-linux.zip
          unzip -q sonar-scanner.zip
          ./sonar-scanner-*/bin/sonar-scanner \
            -Dsonar.projectKey=RAYHAAN-DEV_INSY7314_Task3_Complete_Project \
            -Dsonar.organization=st10214465-vcconnect-edu-za \
            -Dsonar.sources=. \
            -Dsonar.host.url=https://sonarcloud.io \
            -Dsonar.login=$SONAR_TOKEN

workflows:
  version: 2
  build_and_analyze:
    jobs:
      - build
      - sonar_scan:
          requires:
            - build
